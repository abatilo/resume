version: '1.0'
steps:
  clone:
    title: Clone
    type: git-clone
    arguments:
      repo: 'abatilo/resume'
      git: github
      revision: 'master'
  version:
    title: Get Version
    type: freestyle
    arguments:
      image: 'alpine:latest'
      working_directory: 'resume/'
      commands:
        - cf_export VERSION=$(cat version.txt)
  build:
    title: Build
    type: build
    image_name: 'abatilo/resume'
    working_directory: 'resume'
  push:
    type: push
    title: Push
    registry: abatilo
    candidate: ${{build}}
    tag: ${{VERSION}}
  install:
    image: 'codefresh/cfstep-helm:2.9.1'
    title: Install
    environment:
      - CHART_REF=resume/resume
      - RELEASE_NAME=resume
      - KUBE_CONTEXT=chopper
      - NAMESPACE=applications
      - VALUESFILE_prod='resume/resume/values.yaml'
      - VALUE_image_tag='${{VERSION}}'
